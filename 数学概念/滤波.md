# 滤波 TODO
- >个人感觉滤波的方法，都是基于状态转移(运动方差)，和观测方程进行的推到，重点是先把这两个方程推到出来，然后带入预测和更新公式就好。
## 卡尔曼滤波器 KF
### 已知
- 先验、状态转移矩阵（包含状态转移误差$\omega_k $的协方差$R$）$x_k = Ax_{k-1} + u_k + \omega_k $
- 观测方程（包含观测误差$ v_k$的协方差$Q$）$z_k = Cx_k + v_k$
- 上一个状态量的先验$x_{k-1}$

### 预测
- 先验状态$x_k = Ax_{k-1}+u_k$
- 先验协方差$P_k=AP_{k-1}A^T+R_k$
### 更新
- 卡尔曼增益$K_k = P_kC^T(CP_kC^T+R)^{-1}$
- 后验状态$x_k^* = x_k + K_k(z_k-Cx_k)$
- 后验协方差$P_k^* = (I-K_kC)P_k$

### 求解与推到[参考讲解](https://www.bilibili.com/video/BV1ez4y1X7eR/?spm_id_from=333.999.0.0&vd_source=d2698384821931f16375af13c5b44a9f)
- 当前状态时刻的后验$x_k^*$，使得$error = x_{k_{true}} - x_k^*$最小
- 等价与使得error的协方差最小
- 结果是当卡尔曼增益$K_k = P_kC^T(CP_kC^T+R)^{-1}$时误差最小
- 先验协方差$P_k = AP_{k-1}^*A^T+Q$是先验状态估计和真实值的误差$error = x_{k_{true}}-x_k = Ae_{k-1}+\omega_{k-1}$的协方差。
## 扩展卡尔曼滤波 EKF
### 特点
- EKF通过在均值附近对非线性方程一阶泰勒展开，通过获取非线性函数在均值的斜率来构造近似线性函数。也就是$A,B,C$是不固定的。
- 误差状态总是在原点0附近，远离了奇异值、万向节锁等问题，从而确保卡尔曼滤波时候的合理性和有效性。

## 误差状态卡尔曼滤波 ESKF
- 所有的状态均使用误差状态来表达
### 已知
- 先验、状态转移矩阵（包含状态转移误差$\omega$的协方差$R$）$\delta x = F\delta x + \omega $
- 观测方程（包含观测误差$ v$的协方差$Q$）$z = Hx + v$
- 上一个状态量的先验$x_{k-1}$

### 预测
- 先验状态$\delta x_{pre} = F\delta x$
- 先验协方差$P_{pre} = FPF^T+R$
### 更新
- 卡尔曼增益$K = P_{pre}H^T(HP_{pre}H^T+Q)^{-1}$
- 后验状态$\delta x = K(z-Hx)$
- 后验状态$x = x_{pre} + \delta x$
- 后验协方差$P = (I-KH)P_{PRE}$
### 对比KF优点
- 使用三维变量表达旋转，没有冗余和万向锁问题。
- 总在原点附近，离奇异点远，数值更稳定，线性化近似效果更好。
- 状态量为小量，二阶变量可忽略。
- 状态转移方程，运动学方程比原状态变量更小。
